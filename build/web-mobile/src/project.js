require=function e(t,o,n){function i(r,s){if(!o[r]){if(!t[r]){var u="function"==typeof require&&require;if(!s&&u)return u(r,!0);if(c)return c(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var l=o[r]={exports:{}};t[r][0].call(l.exports,function(e){var o=t[r][1][e];return i(o?o:e)},l,l.exports,e,t,o,n)}return o[r].exports}for(var c="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({chessMgr:[function(e,t,o){"use strict";cc._RFpush(t,"683d1m9EIVGZq90eO0xBzmw","chessMgr");var n=[];n[0]={currentPositon:0,isDead:!1,color:"white"},n[1]={currentPositon:1,isDead:!1,color:"white"},n[2]={currentPositon:2,isDead:!1,color:"white"},n[3]={},n[4]={currentPositon:4,isDead:!1,color:"black"},n[5]={currentPositon:5,isDead:!1,color:"black"},n[6]={currentPositon:6,isDead:!1,color:"black"},n[7]={},t.exports={getStatus:function(e){return n[e].isDead},getCurrentPosition:function(e){return n[e].currentPositon},getColor:function(e){return e!=-1&&n[e].color},setStatus:function(e,t){n[e].isDead=t},setCurrentPosition:function(e,t){n[e].currentPositon=t},setColor:function(){}},cc._RFpop()},{}],chess:[function(e,t,o){"use strict";cc._RFpush(t,"cdd59kcZPxMN4GBLP/YLny0","chess"),cc.Class({"extends":cc.Component,properties:{chess:{"default":null,type:cc.Node}},onLoad:function(){}}),cc._RFpop()},{}],main:[function(e,t,o){"use strict";cc._RFpush(t,"4b290oljLlIVrLHc8ejE/gZ","main");var n=e("pointMgr"),i=(e("chessMgr"),window.io("http://localhost:3000"));cc.Class({"extends":cc.Component,properties:{backgroundAudio:{"default":null,url:cc.AudioClip},pickAudio:{"default":null,url:cc.AudioClip},putAudio:{"default":null,url:cc.AudioClip},chessDieAudio:{"default":null,url:cc.AudioClip},blackChessPrefab:{"default":null,type:cc.Prefab},whiteChessPrefab:{"default":null,type:cc.Prefab},moveAble:!1,movingChessName:"",movingChessColor:"",movingChessIndex:0,oldPositionX:0,oldPositionY:0,currentCanMoveColor:"black",flagWhite:0,flagBlack:1,myUserId:""},onLoad:function(){var e=window.io("http://localhost:3000");e.on("connected",function(t){console.log(t),e.on("getUserId",function(t){this.myUserId=t,e.emit("saveUser",t),console.log("获取到的 id: ",t)})}),this.initChessToPoint(),this.node.on("touchstart",this.onPut,this),this.node.on("changePlayer",this.onChangePlayer,this),this.node.on("checkDiePiece",this.onCheckDiePiece,this),this.node.on("chessMoved",this.onChessMoved,this),this.node.on("chessMoveTo",this.onChessMoveTo,this),e.on("clearPosition",function(e){n.isInpoint(e,function(e){console.log("清空旧位置：",e),n.setStatus(e,!0),n.setCurrentPiece(e,-1),console.log(n.getStatus(e))})}),e.on("chessMoveTo",function(e){cc.find("Canvas").emit("chessMoveTo",e)})},onChessMoved:function(e){console.log(e.detail),console.log(e.detail.chessNumber,e.detail.newPosition),i.emit("chessMoveTo",e.detail),cc.find("Canvas").emit("changePlayer",this)},onChessMoveTo:function(t){var o=t.detail.chessNumber,n=parseInt(t.detail.newPosition),i=e("pointMgr"),c=cc.find("Canvas").getChildByName("chessPiece"+o),r=i.getPoint(n).x,s=i.getPoint(n).y;c.runAction(cc.moveTo(.1,r,s)),cc.find("Canvas").emit("changePlayer",this)},onTouchStart:function(e){var t=cc.find("Canvas").getComponent("main");cc.log("name:",this.name),this.chessColor==t.currentCanMoveColor?(cc.find("Canvas").emit("pick",this.name),this.runAction(cc.scaleTo(.1,1.2,1.2)),cc.log(this.chessColor),t.moveAble=!0,t.movingChessName=this.name,t.movingChessColor=this.chessColor,t.movingChessIndex=this.chessIndex,t.oldPositionX=this.x,t.oldPositionY=this.y):alert("还没到你走棋哦！")},onPick:function(e){e.detail!==this.name?(this.runAction(cc.scaleTo(.1,1,1)),cc.find("Canvas").getComponent("main").moveAble=!1):cc.find("Canvas").emit("put",this.name)},onChangePlayer:function(){"black"==this.currentCanMoveColor?this.currentCanMoveColor="white":this.currentCanMoveColor="black"},onPut:function(t){var o=this,n={x:o.oldPositionX,y:o.oldPositionY},c=(cc.find("Canvas").getComponent("main").moveAble,cc.find("Canvas").getComponent("main").movingChessName),r=cc.find("Canvas").getComponent("main").movingChessColor,s=cc.find("Canvas").getComponent("main").movingChessIndex,u=cc.find("Canvas").getChildByName(c),a=this.node.convertToNodeSpaceAR(t.getLocation()),l=e("pointMgr"),h=e("chessMgr");l.isInpoint(a,function(e){var t=l.getPoint(e).x,c=l.getPoint(e).y;if(t&&c&&l.getStatus(e)&&u&&(cc.find("Canvas").getComponent("main").movingChessName="",cc.audioEngine.playEffect(o.putAudio,!1),l.setStatus(e,!1),l.setColor(e,r),i.emit("setOldPosition",n),a!==n)){cc.log("当前移动棋子为：",s,"移动到： ",e);var C={chessNumber:s,newPosition:e};cc.find("Canvas").emit("chessMoved",C),l.setCurrentPiece(e,s),cc.find("Canvas").emit("changePlayer",o),o.onCheckDiePiece(e,function(e,t){cc.log(e),""!==e&&e!==-1&&(o.node.getChildByName("chessPiece"+e).destroy(),cc.log("棋子",e,"死亡"),cc.audioEngine.playEffect(o.chessDieAudio,!1),l.setStatus(t,!0),h.setStatus(e,!0))})}})},onCheckDiePiece:function(t,o){cc.log("移动到了:",t);var n=e("pointMgr"),i=e("chessMgr");if(1==t){var c=i.getColor(n.getCurrentPiece(1)),r=i.getColor(n.getCurrentPiece(0)),s=i.getColor(n.getCurrentPiece(7)),u=i.getColor(n.getCurrentPiece(2)),a=i.getColor(n.getCurrentPiece(3));c==s&&c!=r&&"undefined"!=r?o(n.getCurrentPiece(0),0):c==a&&c!=u&&"undefined"!=u&&o(n.getCurrentPiece(2),2)}if(3==t){var c=i.getColor(n.getCurrentPiece(1)),u=i.getColor(n.getCurrentPiece(2)),a=i.getColor(n.getCurrentPiece(3)),l=i.getColor(n.getCurrentPiece(4)),h=i.getColor(n.getCurrentPiece(5));c==a&&c!=u&&"undefined"!=u?o(n.getCurrentPiece(2),2):a==h&&a!=l&&"undefined"!=l&&o(n.getCurrentPiece(4),4)}if(5==t){var a=i.getColor(n.getCurrentPiece(3)),l=i.getColor(n.getCurrentPiece(4)),h=i.getColor(n.getCurrentPiece(5)),C=i.getColor(n.getCurrentPiece(6)),s=i.getColor(n.getCurrentPiece(7));a==h&&a!=l&&"undefined"!=l?o(n.getCurrentPiece(4),4):h==s&&h!=C&&"undefined"!=C&&o(n.getCurrentPiece(6),6)}if(7==t){var h=i.getColor(n.getCurrentPiece(5)),C=i.getColor(n.getCurrentPiece(6)),s=i.getColor(n.getCurrentPiece(7)),r=i.getColor(n.getCurrentPiece(0)),c=i.getColor(n.getCurrentPiece(1));h==s&&h!=C&&"undefined"!=C?o(n.getCurrentPiece(6),6):s==c&&s!=r&&"undefined"!=r&&o(n.getCurrentPiece(0),0)}},onSetOldPosition:function(t){var o=e("pointMgr");o.isInpoint(t,function(e){o.setStatus(e,!0),o.setCurrentPiece(e,-1)})},setOldPosition:function(e){i.emit("setOldPosition",e)},initChessToPoint:function(){for(var t=this,o=e("pointMgr"),n=e("chessMgr"),i=0;i<8;i++){var c=o.getPoint(i),r=n.getColor(i),s=c.x,u=c.y;if("white"==r){var a=cc.instantiate(t.whiteChessPrefab);t.node.addChild(a),a.setPosition(s,u),a.name="chessPiece"+i,a.chessColor="white",a.chessIndex=i,cc.find("Canvas").on("pick",t.onPick,a),a.on("touchstart",t.onTouchStart,a)}else if("black"==r){var a=cc.instantiate(this.blackChessPrefab);t.node.addChild(a),a.setPosition(s,u),a.name="chessPiece"+i,a.chessColor="black",a.chessIndex=i,cc.find("Canvas").on("pick",t.onPick,a),a.on("touchstart",t.onTouchStart,a)}}},chessMove:function(e){e.on("touchstart",function(){var e=cc.scaleBy(.1,1.5,1.5);this.runAction(e)}.bind(e))},addNewChess:function(){var t=e("chessMgr"),o=t.getPositionX(),n=t.getPositionY(),i=cc.instantiate(this.chessPrefab);this.node.addChild(i),console.log(o,n),i.setPosition(o,n)},update:function(){}}),cc._RFpop()},{chessMgr:"chessMgr",pointMgr:"pointMgr"}],pointMgr:[function(e,t,o){"use strict";cc._RFpush(t,"01d78VFhoxOb42lekaigJsN","pointMgr");var n=[];n[0]={x:-246,y:266,isEmpty:!1,color:"white",currentPiece:0},n[1]={x:4,y:266,isEmpty:!1,color:"white",currentPiece:1},n[2]={x:246,y:266,isEmpty:!1,color:"white",currentPiece:2},n[3]={x:250,y:20,isEmpty:!0,color:"",currentPiece:-1},n[4]={x:244,y:-227,isEmpty:!1,color:"black",currentPiece:4},n[5]={x:1,y:-231,isEmpty:!1,color:"black",currentPiece:5},n[6]={x:-250,y:-227,isEmpty:!1,color:"black",currentPiece:6},n[7]={x:-250,y:14,isEmpty:!0,color:"",currentPiece:-1},t.exports={point:n,getPoint:function(e){return n[e]},getPosition:function(e){return n[e].x+","+n[e].y},getStatus:function(e){return n[e].isEmpty},getColor:function(e){return n[e].color},getCurrentPiece:function(e){return n[e].currentPiece},setStatus:function(e,t){n[e].isEmpty=t,cc.log("设置",e,"为",t)},setColor:function(e,t){n[e].color=t},setCurrentPiece:function(e,t){n[e].currentPiece=t},isInpoint:function(e,t){var o=e.x,n=e.y,i=120;o>i?n<=i&&n>=-i?t(3):n>i?t(2):n<-i&&t(4):o<-i?n>i?t(0):n<=i&&n>=-i?t(7):n<-i&&t(6):t(n>i?1:n<-i?5:"")}},cc._RFpop()},{}]},{},["chess","chessMgr","main","pointMgr"]);